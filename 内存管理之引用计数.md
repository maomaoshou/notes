# iOS内存管理

* 引用计数概念

可以形象的理解为一个对象被对象所持有的次数

* 内存管理原则

    * 自己生成的对象，自己持有

    * 非自己生成的对象，自己也能持有

    * 不再需要**自己持有的**对象时释放该对象

    * 无法释放非自己持有的对象

* GNUstep（Cocoa框架的互换框架）中alloc/retain/release/dealloc的实现

    * 在OC对象中存有引用技术这一整型值
    
    * 调用alloc或者retain方法后，引用计数值加1

    * 调用release后，引用计数减1

    * 引用计数为0时，调用dealloc方法废弃对象

    苹果实现大致与CNUstep一致，不同之处在于苹果是把引用计数存在哈希表中（内存地址作为key），这样做的好处是如果对象的内存地址受到损坏，只要引用计数表没有被破坏，就可以确定各内存块的位置

*  autorelease自动释放

    * autorelease的使用方法

        * 生成并持有NSAutoReleasePool对象

        * 调用已分配对象的autorelease方法

        * 废弃NSAutoReleasePool对象

        上述流程也即NSAutoReleasePool对象的生命周期

    * autorelease的实现机制

    大致为生成NSAutoReleasePool对象，然后要加入autoreleasepool的对象调用addObject方法，最后释放当前autoreleasepool中的所有对象。OC中生成NSAutoReleasePool对象为入栈操作，对应的废弃NSAutoReleasePool对象为出栈操作。

    >注意：NSAutoReleasePool对象调用addObject方法会发生异常

        

